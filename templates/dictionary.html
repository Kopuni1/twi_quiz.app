{% extends "base.html" %}
{% block title %}Dictionary | Twi Learning Platform{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold mb-6 text-orange-600 text-center">Twi Dictionary</h1>

<form method="POST" class="mb-6 flex justify-center gap-2">
  <input type="text" name="word" placeholder="Search a word..." class="w-1/2 px-4 py-2 border rounded text-center">
  <button type="submit" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600">Search</button>
</form>

<!-- Search Results -->
{% if search_results %}
  <div class="mt-6 bg-white p-4 rounded-lg shadow">
    <h3 class="text-lg font-semibold mb-3">Search Results for "{{ search_word }}"</h3>
    <ul class="grid grid-cols-2 gap-4">
      {% for w in search_results %}
        <li class="p-3 rounded shadow {% if w.word.lower() == search_word.lower() %}bg-yellow-100 border-l-4 border-yellow-500{% endif %}">
          <a href="{{ url_for('word_detail', word_id=w.id) }}" class="hover:underline">
            <strong>{{ w.word }}</strong>
          </a>
          {% if w.pronunciation %}<em> ({{ w.pronunciation }})</em>{% endif %}
          <p>{{ w.definition }}</p>
          {% if w.example %}
            <p class="text-sm text-gray-600 italic">Example: {{ w.example }}</p>
          {% endif %}
          {% if w.audio_file %}
            <div class="mt-2">
              <audio id="search-audio-{{ loop.index }}" src="{{ url_for('static', filename='audio/' + w.audio_file) }}"></audio>
              <button onclick="toggleAudio('search-audio-{{ loop.index }}')" class="play-btn">▶</button>
            </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
{% endif %}

<!-- Main Words Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 justify-items-center mt-6">
  {% for w in words %}
    <div class="bg-white p-4 rounded shadow w-full max-w-md">
      <button class="w-full text-left font-semibold flex justify-between items-center" onclick="toggleDropdown('word-{{ loop.index }}')">
        {{ w['word'] }} <span>▼</span>
      </button>
      <div id="word-{{ loop.index }}" class="hidden mt-2 p-3 bg-gray-50 rounded shadow text-left">
        <p><strong>Word:</strong> 
          <a href="{{ url_for('word_detail', word_id=w['id']) }}" class="text-blue-600 hover:underline">{{ w['word'] }}</a>
        </p>
        <p><strong>Pronunciation:</strong> {{ w['pronunciation'] or '-' }}</p>
        <p><strong>Part of Speech:</strong> {{ w['part_of_speech'] or '-' }}</p>
        <p><strong>Definition:</strong> {{ w['definition'] or '-' }}</p>
        <p><strong>Example:</strong> {{ w['example'] or '-' }}</p>
        {% if w['audio_file'] %}
        <div class="mt-2">
          <audio id="audio-{{ loop.index }}" src="{{ url_for('static', filename='audio/' + w['audio_file']) }}"></audio>
          <button onclick="toggleAudio('audio-{{ loop.index }}')" class="play-btn">▶</button>
        </div>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>

<script>
function toggleDropdown(id) {
  const el = document.getElementById(id);
  el.classList.toggle('hidden');
}

function toggleAudio(id) {
  const audio = document.getElementById(id);
  if (audio.paused) {
    audio.play();
  } else {
    audio.pause();
    audio.currentTime = 0;
  }
}
</script>
{% endblock %}
